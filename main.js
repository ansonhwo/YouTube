var videos = [
{
  title: "A Message from President-Elect Donald J. Trump",
  channel: "Transition 2017",
  channelicon: "https://yt3.ggpht.com/-CmoaPOAkgk8/AAAAAAAAAAI/AAAAAAAAAAA/RCGcK9m4sHo/s48-c-k-no-mo-rj-c0xffffff/photo.jpg",
  description: "The President-elect shares an update on the Presidential Transition," +
    " an outline of some of his policy plans for the first 100 days, and his day one executive actions.",
  views: "1,341,158",
  comments: [],
  thumbnail: "https://i.ytimg.com/vi/7xX_KaStFT8/hqdefault.jpg?custom=true&w=196&h=110&stc=true&jpg444=true&jpgq=90&sp=68&sigh=sSuKCtqF5viHrZPjm2RfTsPvqNs",
  embed: 'https://www.youtube.com/embed/7xX_KaStFT8?autoplay=1'
},
{
  title: "Cars 3 Official US Teaser Trailer",
  channel: "Disney-Pixar",
  channelicon: "https://yt3.ggpht.com/-CmoaPOAkgk8/AAAAAAAAAAI/AAAAAAAAAAA/RCGcK9m4sHo/s48-c-k-no-mo-rj-c0xffffff/photo.jpg",
  description: "From this moment, everything will change.\n\nDisney/Pixar's Cars 3 opens in US theatres" +
    " in 3D June 16, 2017.\n\nBlindsided by a new generation of blazing-fast races, the legendary Lightning McQueen (voice of Owen" +
    " Wilson) is suddenly pushed out of the sport he loves. To get back in the game, he will need the help of" +
    " an eager young race technician, Cruz Ramirez, with her own plan to win, plus inspiration from the late Fabulous" +
    " Hudson Hornet and a few unexpected turns.",
  views: "3,258,307",
  comments: [],
  thumbnail: "https://i.ytimg.com/vi/E4K7JgPJ8-s/hqdefault.jpg?custom=true&w=196&h=110&stc=true&jpg444=true&jpgq=90&sp=68&sigh=DEWWRQJ38bHkSaBCT19c7Xeimnw",
  embed: 'https://www.youtube.com/embed/E4K7JgPJ8-s?autoplay=1'
},
{
  title: "Flip Edition | Dude Perfect",
  channel: "Dude Perfect",
  channelicon: "https://yt3.ggpht.com/-CmoaPOAkgk8/AAAAAAAAAAI/AAAAAAAAAAA/RCGcK9m4sHo/s48-c-k-no-mo-rj-c0xffffff/photo.jpg",
  description: "It's time to flip some stuff!\nThanks to Fantasitc Gymnastics by Hasbro Gaming for sponsoring" +
    " this video! Go to http://bit.ly/FantasticGymnasticsDP to get Fantastic Gymnastics for yourself!",
  views: "4,460,870",
  comments: [],
  thumbnail: "https://i.ytimg.com/vi/8YydogFXCPM/hqdefault.jpg?custom=true&w=196&h=110&stc=true&jpg444=true&jpgq=90&sp=68&sigh=MzABtab1-7LFj6m97B5xOS-lCgk",
  embed: 'https://www.youtube.com/embed/8YydogFXCPM?autoplay=1'
},
{
  title: "Billy on the Street: DEATH ROGEN! With Seth Rogen",
  channel: "billyonthestreettv",
  channelicon: "https://yt3.ggpht.com/-CmoaPOAkgk8/AAAAAAAAAAI/AAAAAAAAAAA/RCGcK9m4sHo/s48-c-k-no-mo-rj-c0xffffff/photo.jpg",
  description: "New from Billy on the Street! Watch Billy hit the street with SETH ROGEN in disguise, tell" +
    " people that Seth has died and get their reactions! We call this DEATH ROGEN. Watch full episodes of Billy on the Street Tuesdays at 10:30/9:30c on @TruTV!",
  views: "364,533",
  comments: [],
  thumbnail: "https://i.ytimg.com/vi/A2R2iBc8udc/hqdefault.jpg?custom=true&w=168&h=94&stc=true&jpg444=true&jpgq=90&sp=68&sigh=j7ivnsDvrCl-ucJWKLoscivhtrs",
  embed: 'https://www.youtube.com/embed/diN92St7FA8?autoplay=1'
},
{
  title: "Bullets vs Propeller in Slow Motion - The Slow Mo Guys",
  channel: "The Slow Mo Guys",
  channelicon: "https://yt3.ggpht.com/-CmoaPOAkgk8/AAAAAAAAAAI/AAAAAAAAAAA/RCGcK9m4sHo/s48-c-k-no-mo-rj-c0xffffff/photo.jpg",
  description: "Gary and Dan venture out to the desert to film some bullets. Make sure you watch in HD for maximum bullet" +
    " shockwave action!\nCheers to EA for sponsoring this video. Check out the game at http://www.battlefield.com\n" +
    "Follow Gav on Twitter - https://twitter.com/GavinFree\nFollow Dan on Twitter - https://twitter.com/DanielGruchy",
  views: "1,466,332",
  comments: [],
  thumbnail: "https://i.ytimg.com/vi/ysB-SH19WRQ/hqdefault.jpg?custom=true&w=196&h=110&stc=true&jpg444=true&jpgq=90&sp=68&sigh=9OEQLS6JSWBMQ8sCrd0yZt58lJ8",
  embed: 'https://www.youtube.com/embed/ysB-SH19WRQ?autoplay=1'
},
{
  title: 'The Voice 2016 Billy Gilman - Top 11: "All I Ask"',
  channel: "The Voice",
  channelicon: "https://yt3.ggpht.com/-CmoaPOAkgk8/AAAAAAAAAAI/AAAAAAAAAAA/RCGcK9m4sHo/s48-c-k-no-mo-rj-c0xffffff/photo.jpg",
  description: "Billy Gilman showcases his vocal talent with a powerful rendition of 'All I Ask' by Adele.\n\n" +
    "NBC's The Voice follows the strongest vocalists from across the country and invites them to compete in" +
    " this season's blockbuster vocal competition.",
  views: "213,615",
  comments: [],
  thumbnail: "https://i.ytimg.com/vi/RswuJVHVw_0/hqdefault.jpg?custom=true&w=196&h=110&stc=true&jpg444=true&jpgq=90&sp=68&sigh=6lmdPt82bEpmKOw202Zi67Iwk7U",
  embed: 'https://www.youtube.com/embed/RswuJVHVw_0?autoplay=1'
},
{
  title: "The iPhone 8 Will Be Incredible!",
  channel: "EverythingApplePro",
  channelicon: "https://yt3.ggpht.com/-CmoaPOAkgk8/AAAAAAAAAAI/AAAAAAAAAAA/RCGcK9m4sHo/s48-c-k-no-mo-rj-c0xffffff/photo.jpg",
  description: "iPhone 8 & 8 Plus Rumors & Leaks Have Begun! New Features To Expect & Rumor Roundup With Sources!",
  views: "693,167",
  comments: [],
  thumbnail: "https://i.ytimg.com/vi/MZqyfeUi7As/hqdefault.jpg?custom=true&w=196&h=110&stc=true&jpg444=true&jpgq=90&sp=68&sigh=HDgDRvuiwhCcMHXVT0Gm9eukqU8",
  embed: 'https://www.youtube.com/embed/MZqyfeUi7As?autoplay=1'
},
{
  title: "10 Disney Crossover Easter Eggs That You've Never Seen",
  channel: "Screen Rant",
  channelicon: "https://yt3.ggpht.com/-CmoaPOAkgk8/AAAAAAAAAAI/AAAAAAAAAAA/RCGcK9m4sHo/s48-c-k-no-mo-rj-c0xffffff/photo.jpg",
  description: "Animated movies are a right of passage for most children, and nobody does them better than Disney. Every child remembers watching Snow White and" +
    " The Little Mermaid for the first time, and most of us are still heading to theatres whenever a new Pixar film comes out. But we don't always catch the Easter" +
    " eggs left there by mischievious animators, or the cameos that some Disney characters make in movies that aren't their own.",
  views: "260,853",
  comments: [],
  thumbnail: "https://i.ytimg.com/vi/KBTwUOsO4d0/hqdefault.jpg?custom=true&w=196&h=110&stc=true&jpg444=true&jpgq=90&sp=68&sigh=Ue_RmuQ0uggRmpbxvxQAiC-w060",
  embed: 'https://www.youtube.com/embed/KBTwUOsO4d0?autoplay=1'
}];
var users = [{
  name: "User1",
  icon: "http://simpleicon.com/wp-content/uploads/user1.png"
},
{
  name: "User2",
  icon: "https://cdn0.iconfinder.com/data/icons/PRACTIKA/256/user.png"
},
{
  name: "User3",
  icon: "http://downloadicons.net/sites/default/files/women-business-user-icon-44928.png"
},
{
  name: "User4",
  icon: "https://cdn0.iconfinder.com/data/icons/PRACTIKA/256/user.png"
}];
var currentUser = 1;


// Deletes all of the children associated with the provided element ID.
function deleteChild(element) {
  while (element.hasChildNodes()) {
    element.removeChild(element.lastChild);
  }
}


/** ===========================================================================
tagName (string): h1, div, span, etc.
attributes (object): {key1: value1, key2: value2, ...}
children (array): could be an array of elements, strings, string & elements...
=========================================================================== **/

function createElement(tagName, attributes, children) {
  var element = document.createElement(tagName);
  for (var key in attributes) {
    element.setAttribute(key, attributes[key]);
  }
  for (var index = 0; index < children.length; index++) {
    var child = children[index];
    if (child instanceof Element) {
      element.appendChild(child);
    }
    else {
      element.appendChild(document.createTextNode(child));
    }
  }
  return element;
}


// Helper function to create elements with a specified id/class
function newElement(type, attribute1, attribute2) {
  if (!type) return;
  var $element = document.createElement(type);

  if (!attribute1 || !attribute2) return $element;
  $element.setAttribute(attribute1, attribute2);

  return $element;
}


// Return an array of matched video objects based on user query.
function findMatch(query) {
  var videoList = [];

  for (var index = 0; index < videos.length; index++) {
    var itemText = videos[index].description + videos[index].title + videos[index].channel;
    if (itemText.toLowerCase().includes(query.toLowerCase())) {
      videoList.push(videos[index]);
    }
  }

  return videoList;
}


// Builds video list with videos that match the user's search query
function buildVideoList(elements) {
  var $videoList = document.getElementById('videos');
  var $videoBlock = newElement('div', 'id', 'videoblock');

  $videoList.appendChild($videoBlock);

  for (var index = 0; index < elements.length; index++) {
    var $videoDetails = newElement('div', 'id', 'videodetails');
    var $videoImage = newElement('img', 'class', 'videoimg');
    var $videoTitle = newElement('h4', 'class', 'videotitle');
    var $videoChannel = newElement('p', 'class', 'videochannel');
    var $videoViews = newElement('p', 'class', 'videoviews');
    var $videoDesc = newElement('p', 'class', 'videodesc');
    var $link1 = newElement('a', 'href', '#');
    var $link2 = newElement('a', 'href', '#');

    $videoBlock.appendChild($videoDetails);

    $videoImage.setAttribute('src', elements[index].thumbnail);
    $videoImage.setAttribute('data-embed', elements[index].embed);
    $videoDetails.appendChild($link1);
    $link1.appendChild($videoImage);

    $videoTitle.textContent = elements[index].title;
    $videoTitle.setAttribute('data-embed', elements[index].embed);
    $videoDetails.appendChild($link2);
    $link2.appendChild($videoTitle);

    $videoChannel.textContent = elements[index].channel;
    $videoDetails.appendChild($videoChannel);

    $videoViews.textContent = elements[index].views + " views";
    $videoDetails.appendChild($videoViews);

    $videoDesc.textContent = elements[index].description;
    $videoDetails.appendChild($videoDesc);
  }
}


// Builds the video viewing area containing video related details
function buildViewingArea(embed) {
  // Embedded video area
  buildVideoArea(embed);

  // Video detail area
  buildVideoDetails(embed);

  // Add comments area
  addCommentsArea();

  // Associated user comments area
  var index = findVideo(embed);
  userCommentsArea(index);
}


function buildVideoArea(embed) {
  var $videos = document.getElementById('videos');
  var $viewingArea = newElement('div', 'id', 'viewingarea');
  var $embed = newElement('div', 'id', 'embed');
  var $showVideo = newElement('iframe', 'width', '560px');

  $showVideo.setAttribute('height', '480px');
  $showVideo.setAttribute('width', '854px');
  $showVideo.setAttribute('src', embed);
  $showVideo.setAttribute('frameborder', 0);
  $showVideo.setAttribute('allowfullscreen', '');
  $showVideo.setAttribute('id', 'uservideo');
  $videos.appendChild($viewingArea);
  $viewingArea.appendChild($embed);
  $embed.appendChild($showVideo);
}


function buildVideoDetails(embed) {
  var $videos = document.getElementById('videos');
  var $videoinfo = newElement('div', 'id', 'videoinfo');
  var $titlebox = newElement('div', 'id', 'titlebox');
  var $title = newElement('h2', 'class', 'title');
  var $channelbox = newElement('div', 'id', 'channelbox');
  var $channel = newElement('p', 'class', 'channel');
  var $channelicon = newElement('img', 'class', 'videoicon');
  var $description = newElement('p', 'class', 'desc');
  var $views = newElement('p', 'class', 'views');

  $videos.appendChild($videoinfo);

  var index = findVideo(embed);
  var title = videos[index].title;
  var channel = videos[index].channel;
  var channelicon = videos[index].channelicon;
  var description = videos[index].description;
  var views = videos[index].views;

  $title.textContent = title;
  $channel.textContent = channel;
  $channelicon.setAttribute('src', channelicon);
  $description.textContent = description;
  $views.textContent = views + " views";

  $videoinfo.appendChild($titlebox);
  $titlebox.appendChild($title);
  $videoinfo.appendChild($channelbox);
  $channelbox.appendChild($channelicon);
  $channelbox.appendChild($channel);
  $videoinfo.appendChild($views);
  $videoinfo.appendChild($description);
}


// Helper function that creates the Add Comment section
function addCommentsArea() {
  var $videos = document.getElementById('videos');
  var $addComments = newElement('div', 'id', 'addcomments');
  var $commentWrapper = newElement('div', 'class', 'wrap');
  var $commentHeader = newElement('h4', 'class', 'header');
  var $comment = newElement('form', '', '');
  var $commentInput = newElement('textarea', 'class', 'input');
  var $author = newElement('span', 'class', 'author');
  var $userIcon = newElement('img', 'src', users[currentUser].icon);
  var $buttonwrap = newElement('div', 'class', 'buttonwrap');
  var $cancel = newElement('button', 'class', 'cancelcomment');
  var $submit = newElement('button', 'class', 'submitcomment');

  $comment.setAttribute('action','');
  $commentInput.setAttribute('placeholder', 'Add a public comment...');
  $commentInput.setAttribute('type', 'text');
  $commentInput.setAttribute('name', 'comment');
  $userIcon.setAttribute('class', 'icon');
  $videos.appendChild($addComments);
  $addComments.appendChild($commentHeader);
  $addComments.appendChild($author);
  $author.appendChild($userIcon);
  $addComments.appendChild($commentWrapper);
  $commentWrapper.appendChild($comment);
  $comment.appendChild($commentInput);
  $commentWrapper.appendChild($buttonwrap);
  $cancel.textContent = "Cancel";
  $submit.textContent = "Comment";
  $buttonwrap.appendChild($submit);
  $buttonwrap.appendChild($cancel);
}


// Helper function that creates the User Comments area
function userCommentsArea(video) {
  var $videos = document.getElementById('videos');
  var $commentHeader = document.querySelector('#addcomments .header');
  var numComments = videos[video].comments.length;

  $commentHeader.textContent = "COMMENTS • " + numComments;

  if (numComments > 0) {
    var $exists = document.getElementById('usercomments');

    if ($exists) {
      deleteChild($exists);
      populate(video, $exists, numComments);
    }
    else {
      var $userComments = newElement('div', 'id', 'usercomments');
      $videos.appendChild($userComments);
      populate(video, $userComments, numComments);
    }
  }
}


// Helper function that adds comments to user comment area
function populate(video, $element, numComments) {
  for (var index = 0; index < numComments; index++) {
    var $commentWrap = newElement('div', 'class', 'wrap');
    var $commentBlock = newElement('div', 'class', 'block');
    var $icon = newElement('img', 'src', videos[video].comments[index].icon);
    var $author = newElement('span', 'class', 'author');
    var $user = newElement('p', 'class', 'user');
    var $comment = newElement('p', 'class', 'comment');
    $icon.setAttribute('class', 'icon');
    $element.appendChild($commentBlock);
    $commentBlock.appendChild($author);
    $author.appendChild($icon);
    $commentBlock.appendChild($commentWrap);
    $user.textContent = videos[video].comments[index].user;
    $commentWrap.appendChild($user);
    $comment.textContent = videos[video].comments[index].comment;
    $commentWrap.appendChild($comment);
  }
}


// Adds a new comment to the current video
function addComment(video, user) {
  var $input = document.querySelector('#addcomments .input');
  var input = $input.value.trim();
  if (input) {
    var comment = new Comment(users[user].name, users[user].icon, 40, input);
    videos[video].comments.unshift(comment);
    $input.value = '';
    userCommentsArea(video);
  }
}


// Comment object constructor
function Comment(user, icon, age, comment) {
  this.user = user;
  this.icon = icon;
  this.age = age;
  this.comment = comment;
}


// Helper function that returns index of target video in video database
function findVideo(embed) {
  for (var index = 0; index < videos.length; index++) {
    if (videos[index].embed === embed) {
      return index;
    }
  }
}


document.addEventListener('submit', function(event) {

  event.preventDefault();

  var query = document.getElementById('searchbar').value;

  if (query.trim()) {
    query = query.trim();
    var videoList = findMatch(query);
    var $videoBlock = newElement('div', 'class', 'videoblock');
    var $videos = document.getElementById('videos');

    $videos.appendChild($videoBlock);

    deleteChild($videos);

    if (videoList.length > 0) {
      buildVideoList(videoList);
    }
    else {
      var $invalidSearch = newElement('h2', 'id', 'invalidsearch');

      $invalidSearch.textContent = 'No results found for: ' + query + '.';
      $videos.appendChild($invalidSearch);
    }
  }
  else return;

});


document.addEventListener('click', function(event) {
  var $target = event.target;
  var embedURL;
  if ($target.className === 'videoimg' || $target.className === 'videotitle') {
    event.preventDefault();

    var $videos = document.getElementById('videos');
    embedURL = $target.getAttribute("data-embed");

    deleteChild($videos);

    buildViewingArea(embedURL);
  }
  if ($target.className === 'submitcomment') {
    embedURL = document.getElementById('uservideo').getAttribute('src');
    addComment(findVideo(embedURL), currentUser);
  }
  if ($target.className === 'cancelcomment') {
    document.querySelector('#addcomments .input').value = '';
  }
});
